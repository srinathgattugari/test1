---
# Role to setup Jenkins running as daemon
- hosts: localhost
  vars_files:
    - ../vars/ldap.yml
  environment:
    LDAP_PASSWORD: "{{ VAULT_LDAP_PASSWORD }}"

  tasks:
    - name: Creating jenkins-pf.service.d directory in path /etc/systemd/system/ if it doesn't exist.
      file:
        path: /etc/systemd/system/jenkins-pf.service.d
        state: directory
        owner: root
        group: root
        mode: 0755

    - name: Copying jenkins-docker.service file in /etc/systemd/system/ directory.
      copy:
        src: jenkins-pf.service
        dest: /etc/systemd/system/
        owner: root
        group: root
        mode: 0644
    
    - name: Copying override.j2 file in /etc/systemd/system/jenkins-pf.service.d directory.
      copy:
        src: override.j2
        dest: /etc/systemd/system/jenkins-pf.service.d/
        owner: root
        group: root
        mode: 0644
    
    - name: Templating override.j2 to /etc/systemd/system/jenkins-pf.service.d directory.
      template:
        src: /etc/systemd/system/jenkins-pf.service.d/override.j2
        dest: /etc/systemd/system/jenkins-pf.service.d/override.conf
        owner: root
        group: root
        mode: 0640